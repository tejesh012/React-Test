<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>
    <style>
      body{
        font-family:Arial;
        
        margin-top:0;
        margin-bottom:0
      }
      .appContainer{
        /* padding-top:20px;
        padding-bottom:40px; */
        max-width:600px;
        margin-left:auto;
        margin-right:auto;
        display:flex;
        flex-direction:column;
        height:100vh;
      }
      .chatInputContainer{
        display:flex; 
        margin-bottom:40px;

      }
      .sendButton{
        background-color:rgb(25, 135, 84);
        color: white;
        padding:12px 20px;
        border:None;
        font-size:15px;
        border-radius:10px;
        margin-left:10px;
        cursor:pointer;

      }
      .chatInput{
        font-size:15px;
        padding:12px 15px;
        border-width:1px;
        
        border-radius:10px;
        /* padding:10px 20px; */
        flex-grow:1;
      }
      .userMessageDiv{
        display:flex;
        justify-content:end;
        align-items:start
      }
      .messageDiv{
        background-color:hsla(0, 0%, 75%, 0.975);
        border-radius:10px;
        margin-right:10px;
        padding:15px 20px;
        margin-left:10px;
        margin-bottom:20px;
        max-width:300px;
        
      }
      .robotMessageDiv{
        display:flex;
        justify-content:start;
        align-items:start
      }
      .chatMessagesContainer{
        margin-top:20px;
        flex-grow:1;
        overflow:scroll;
        scrollbar-width:none
      }

    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

      const container = document.querySelector('.js-container');

      function ChatInput({chatMessages,setChatMessages}){
        const [inputText, setInputText] = React.useState('');
        const [isLoading,setIsLoading] = React.useState(false);
        function SaveInputText(event){
          setInputText(event.target.value);
        }
        async function SendMessage(){
          if (inputText === '' || isLoading){
            return
          }
          
          setIsLoading(true)
          const newChatMessages = [
            ...chatMessages,
            {
              message: inputText,
              sender: "user",
              id : crypto.randomUUID()
            }
           
          ]
          setChatMessages([
            ...newChatMessages,{
              message: "Loading",
              sender: "robot",
              id: crypto.randomUUID()
            }
          ]);
          setInputText(''); 

          const botMessage = await(chatbot.getResponseAsync(inputText));
          setChatMessages([
            ...newChatMessages,
            {
              message: botMessage,
              sender: "robot",
              id : crypto.randomUUID()
            },
          ]);
          setIsLoading(false)
          
        }
        return(
          <div className = "chatInputContainer">
            <input
              className = "chatInput"
              type="text" 
              placeholder="Send a message to ChatBot" 
              size="30"
              onChange={SaveInputText}
              value={inputText}
              onKeyDown = {
                event =>{
                  if (event.key =="Enter"){
                    SendMessage()
                  }
                  else if (event.key == "Escape" || event.key == "Esc"){
                    setInputText('');
                  }
                }
              }
            />
            <button 
              onClick = {SendMessage}
              className = "sendButton"
            >
              Send
            </button>
          </div>
        )
      }

      function ChatMessage({ message, sender }) {
        //const { message, sender } = props;
      
        return(
          <div className = { sender=="user" ? "userMessageDiv" : "robotMessageDiv"}>
            {sender === "robot" && (
              <img src="robot.png" width = "50"/>
            )}
            <div className = "messageDiv">
             {message} 
            </div>
            
            {sender === "user" && (
              <img src="user.png" width = "50"/>
            )}
          </div>
        )
      
      }

      function ChatMessages({chatMessages}){
        const chatMessagesRef = React.useRef(null);

        React.useEffect(()=>{
          const containerElem = chatMessagesRef.current
          if(containerElem){
            containerElem.scrollTop = containerElem.scrollHeight;
          }
        },[chatMessages]);
        return (
          <div 
            className="chatMessagesContainer"
            ref = {chatMessagesRef}
          
          >

            {chatMessages.map((chatmessage)=>{
              return(
                <ChatMessage
                  message = {chatmessage.message}
                  sender = {chatmessage.sender}
                  key = {chatmessage.id}
                />
              );
            })}
          </div>
        )
      }
      
      

      function App(){
        const [chatMessages , setChatMessages ] = React.useState(
           [
            {
              message: "Hello ChatBot",
              sender: "user",
              id : "id1"
            },
            {
              message: "Hello! How can I help you?",
              sender: "robot",
              id : "id2"
            }
          ] 
        );
        
        return(
          <div className="appContainer">
            <ChatMessages 
              chatMessages = {chatMessages}
              />
            <ChatInput 
              chatMessages= {chatMessages}
              setChatMessages= {setChatMessages}
            />
          </div>
        )
      }
      // const app = (
      //   <>
      //     <ChatInput />
      //     <ChatMessage 
      //       message = "Hello ChatBot"
      //       sender = "user"
      //     />
      //     <ChatMessage 
      //       message = "Hello! How can I help you?" 
      //       sender = "robot"
      //     />
      //   </>
      // );
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
      
    </script>
  </body>
</html>